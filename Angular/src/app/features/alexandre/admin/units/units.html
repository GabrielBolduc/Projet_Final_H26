<div class="admin-page">
  <header class="admin-top-bar">
    <button mat-stroked-button class="btn-new" (click)="openForm()">
      <mat-icon class="material-icons">add</mat-icon> 
      {{ 'UNITS.NEW_UNIT' | translate }}
    </button>
    <h1 class="header-title">{{ 'UNITS.TITLE' | translate }}</h1>
    <div class="spacer-right" style="flex: 1; max-width: 250px;"></div>
  </header>

  <main>
    <div class="packages-grid">
      @for (unit of units(); track unit.id) {
      <mat-card class="ticket-card">
        <div class="card-content-layout">

          <div class="ticket-visual">
            <img [src]="unit.image_url || 'assets/placeholder-unit.png'" alt="unit image">
            <span class="category-badge" [ngClass]="(unit.type || '').split('::').pop()?.toLowerCase() || ''">
              {{ 'UNITS.TYPES.' + formatType(unit.type) | translate }}
            </span>
          </div>

          <div class="ticket-info">
            <div class="info-header">
              <h3>{{ 'UNITS.TYPES.' + formatType(unit.type) | translate }}</h3>
              <span class="price">{{ unit.cost_person_per_night | currency:'CAD':'symbol-narrow' }} / night</span>
            </div>

            <div class="date-info">
              <strong>{{ 'UNITS.FEATURES' | translate }}:</strong>
              <mat-icon *ngIf="unit.wifi" class="material-icons">wifi</mat-icon>

              @if (parentCategory() !== 1 && parentCategory() !== 'hotel') {
                <mat-icon *ngIf="unit.electricity" class="material-icons">bolt</mat-icon>
                <span>
                  {{ 'UNITS.WATER' | translate }} : 
                  {{ 'UNITS.WATER_STATUS.' + formatWaterKey(unit.water) | translate }}
                </span>
              }
            </div>

            <p class="description">
              {{ 'UNITS.PARKING' | translate }}: {{ unit.parking_cost | currency:'CAD' }} |
              {{ 'UNITS.FOOD' | translate }}: 
              @for (opt of unit.food_options; track opt; let last = $last) {
                {{ 'UNITS.FOOD_OPTIONS_LABELS.' + opt | translate }}{{ !last ? ', ' : '' }}
              }
            </p>

            <div class="quota-section">
              <div class="quota-labels">
                <span>{{ 'UNITS.AVAILABLE_QTY' | translate }}: </span>
                <span>{{ unit.quantity }} {{ 'UNITS.UNITS' | translate }}</span>
              </div>
              <mat-progress-bar mode="determinate" [value]="100"></mat-progress-bar>
            </div>
          </div>

          <div class="ticket-actions">
            <button mat-icon-button class="action-btn edit" (click)="openForm(unit)">
              <mat-icon class="material-icons">edit</mat-icon> 
            </button>
            <button mat-icon-button class="action-btn delete" (click)="deleteUnit(unit)">
              <mat-icon class="material-icons">delete</mat-icon> 
            </button>
          </div>

        </div>
      </mat-card>
      } @empty {
      <div class="empty-state">
        <mat-icon class="material-icons">inventory_2</mat-icon>
        <p>{{ 'ACCOMMODATIONS.NOT_FOUND' | translate }}</p>
      </div>
      }
    </div>
  </main>
</div>

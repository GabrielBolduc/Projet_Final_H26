<div class="admin-page">
  <header class="admin-top-bar">
      <button mat-stroked-button class="btn-new" (click)="openForm()">
        <mat-icon>add</mat-icon> {{ 'TICKETING_ADMIN.NEW_PACKAGE' | translate }}
      </button>
      <h1 class="header-title">{{ 'TICKETING_ADMIN.TITLE' | translate }}</h1>
  </header>

  <section class="filters-section">
    <mat-form-field appearance="outline" class="search-bar">
      <mat-icon matPrefix>search</mat-icon>
      <input matInput [placeholder]="'TICKETING_ADMIN.SEARCH_TITLE' | translate" [(ngModel)]="searchQuery">
    </mat-form-field>

    <mat-form-field appearance="outline" class="sort-select">
      <mat-label>{{ 'TICKETING_ADMIN.SORT_BY' | translate }}</mat-label>
      <mat-select [(ngModel)]="sortOption">
        <mat-option value="all">{{ 'TICKETING_ADMIN.SORT_ALL' | translate }}</mat-option>
        <mat-option value="qty_asc">{{ 'TICKETING_ADMIN.SORT_ASC' | translate }}</mat-option>
        <mat-option value="qty_desc">{{ 'TICKETING_ADMIN.SORT_DESC' | translate }}</mat-option>
      </mat-select>
    </mat-form-field>
  </section>

  <main>
    <div class="packages-grid">
      @for (pkg of filteredPackages(); track pkg.id) {
        <mat-card class="ticket-card">
          <div class="card-content-layout">
            
            <div class="ticket-visual">
              <img [src]="pkg.image_url || 'assets/placeholder-ticket.png'" alt="ticket">
              <span class="category-badge" [ngClass]="pkg.category.toLowerCase()">
                {{ 'PACKAGE_FORM.TYPE_' + (pkg.category | uppercase) | translate }}
              </span>
            </div>

            <div class="ticket-info">
              <div class="info-header">
                <h3>{{ pkg.title }}</h3>
                <span class="price">{{ pkg.price | currency:'CAD':'symbol-narrow' }}</span>
              </div>
              
              <div class="date-info">
                <strong>{{ 'TICKETING_ADMIN.DATE' | translate }}</strong> 
                @if ((pkg.valid_at | date:'yyyy-MM-dd') === (pkg.expired_at | date:'yyyy-MM-dd')) {
                  {{ pkg.valid_at | date:'yyyy-MM-dd' }} 
                  ({{ pkg.valid_at | date:'HH:mm' }} - {{ pkg.expired_at | date:'HH:mm' }})
                } @else {
                  {{ 'TICKETING_ADMIN.FROM' | translate }} {{ pkg.valid_at | date:'yyyy-MM-dd' }} 
                  {{ 'TICKETING_ADMIN.TO' | translate }} {{ pkg.expired_at | date:'yyyy-MM-dd' }}
                }
              </div>
              
              <p class="description">{{ pkg.description }}</p>

              <div class="quota-section">
                <div class="quota-labels">
                  <span>{{ 'TICKETING_ADMIN.SALES' | translate }}</span>
                  <span>{{ pkg.sold || 0 }} / {{ pkg.quota }}</span>
                </div>
                <mat-progress-bar mode="determinate" [value]="((pkg.sold || 0) / (pkg.quota || 1)) * 100"></mat-progress-bar>
              </div>
            </div>

            <div class="ticket-actions">
              <button mat-icon-button class="action-btn" (click)="openForm(pkg)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button class="action-btn delete" (click)="deletePackage(pkg)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>

          </div>
        </mat-card>
      }
    </div>
  </main>
</div>
<div class="dashboard-layout">
  <main class="admin-page">
    
    <header class="admin-top-bar">
      <div class="spacer-right" style="flex: 1; max-width: 250px;"></div>
      
      <h1 class="header-title">{{'PUBLIC.PROGRAMMATION' | translate}}</h1>
      
      <div class="spacer-right" style="flex: 1; max-width: 250px;"></div>
    </header>

    @if (isLoading()) {
      <div class="loading-state"><p>{{'DASHBOARD.LOADING' | translate}}</p></div>
    }

    @if (!isLoading() && !currentFestival()) {
      <div class="empty-state">
        <mat-icon class="empty-icon">event_busy</mat-icon>
        <h2>{{'PUBLIC.NO_FESTIVAL_TITLE' | translate}}</h2>
        <p>{{'PUBLIC.NO_FESTIVAL_DESC' | translate}}</p>
      </div>
    }

    @if (!isLoading() && currentFestival() && performanceGroups().length === 0) {
      <div class="empty-state">
        <p>{{'DASHBOARD.NOTHING' | translate}}</p>
      </div>
    }

    @if (currentFestival(); as f) {
      @if (performanceGroups().length > 0) {
        
        <section class="festival-info">
          <h2 class="festival-name">{{ f.name }}</h2>
          <p class="festival-dates">
            <mat-icon>calendar_today</mat-icon>
            {{ f.start_at | date:'d MMMM' : undefined : currentLang() }} - 
            {{ f.end_at | date:'d MMMM yyyy' : undefined : currentLang() }}
          </p>
        </section>

        @for (group of performanceGroups(); track group.date) {
          <section class="admin-section">
            <h2 class="section-label">
              {{ group.date | date:'EEEE d MMMM' : undefined : currentLang() | titlecase }}
            </h2>
            
            <div class="grid-table-container">
              <table mat-table [dataSource]="group.performances" class="festify-grid-table">

                <ng-container matColumnDef="artist">
                  <th mat-header-cell *matHeaderCellDef> {{'DASHBOARD.ARTIST' | translate}} </th>
                  <td mat-cell *matCellDef="let perf" class="bold-text"> 
                    {{ perf.artist?.name || 'Inconnu' }} 
                  </td>
                </ng-container>

                <ng-container matColumnDef="title">
                  <th mat-header-cell *matHeaderCellDef> {{'DASHBOARD.TITLE' | translate}} </th>
                  <td mat-cell *matCellDef="let perf"> {{ perf.title }} </td>
                </ng-container>

                <ng-container matColumnDef="stage">
                  <th mat-header-cell *matHeaderCellDef> {{'DASHBOARD.STAGE' | translate}} </th>
                  <td mat-cell *matCellDef="let perf"> {{ perf.stage?.name || 'N/A' }} </td>
                </ng-container>

                <ng-container matColumnDef="start_at">
                  <th mat-header-cell *matHeaderCellDef> {{'DASHBOARD.START' | translate}} </th>
                  <td mat-cell *matCellDef="let perf"> 
                    {{ perf.start_at | date:'HH:mm' : undefined : currentLang() }} 
                  </td>
                </ng-container>

                <ng-container matColumnDef="end_at">
                  <th mat-header-cell *matHeaderCellDef> {{'DASHBOARD.END' | translate}} </th>
                  <td mat-cell *matCellDef="let perf"> 
                    {{ perf.end_at | date:'HH:mm' : undefined : currentLang() }} 
                  </td>
                </ng-container>

                 <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef> {{'DASHBOARD.NOTE' | translate}} </th>
                  <td mat-cell *matCellDef="let perf" class="desc-cell">
                    {{ perf.description | slice:0:25 }}{{ perf.description && perf.description.length > 25 ? '...' : '' }}
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>
            </div>
          </section>
        }
      }
    }
  </main>
</div>